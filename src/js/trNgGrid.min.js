"use strict";var TrNgGrid;(function(n){var t,r,o,s,f,e,nt,v,h,c,y;(function(n){n[n.None=0]="None";n[n.SingleRow=1]="SingleRow";n[n.MultiRow=2]="MultiRow";n[n.MultiRowWithKeyModifiers=3]="MultiRowWithKeyModifiers"})(n.SelectionMode||(n.SelectionMode={}));t=n.SelectionMode;r="trNgGrid";n.dataPagingFilter=r+"DataPagingFilter";n.columnTitleDisplayNameFilter=r+"ColumnTitleDisplayNameFilter";var b="tr-ng-grid-body",k="auto-generated",l="field-name",d="is-customized",a="trNgGridFooter",g="tr-ng-grid-footer";n.footerTemplateId=a+".html";o="trNgGridGlobalFilter";n.globalFilterDirectiveAttribute="tr-ng-grid-global-filter";n.footerGlobalFilterTemplateId=o+".html";s="trNgGridPager";n.pagerDirectiveAttribute="tr-ng-grid-pager";n.footerPagerTemplateId=s+".html";f="trNgGridHeaderCell";e="tr-ng-grid-header-cell";n.cellHeaderTemplateId=f+".html";nt="trNgGridBodyCell";v="tr-ng-grid-body-cell";n.cellBodyTemplateId="";h="trNgGridColumnSort";n.columnSortDirectiveAttribute="tr-ng-grid-column-sort";n.columnSortTemplateId=h+".html";c="trNgGridColumnFilter";n.columnFilterDirectiveAttribute="tr-ng-grid-column-filter";n.columnFilterTemplateId=c+".html";y="tr-ng-grid-row-page-item-index";n.tableCssClass="tr-ng-grid table table-bordered table-hover";n.cellCssClass="tr-ng-cell";n.columnContentsCssClass="tr-ng-column-header "+n.cellCssClass;n.columnTitleCssClass="tr-ng-title";n.columnSortCssClass="tr-ng-sort";n.columnFilterCssClass="tr-ng-column-filter";n.columnFilterInputWrapperCssClass="";n.columnSortActiveCssClass="tr-ng-sort-active text-info";n.columnSortInactiveCssClass="tr-ng-sort-inactive text-muted";n.columnSortReverseOrderCssClass="tr-ng-sort-order-reverse glyphicon glyphicon-chevron-up";n.columnSortNormalOrderCssClass="tr-ng-sort-order-normal glyphicon glyphicon-chevron-down";n.rowSelectedCssClass="active";n.footerCssClass="tr-ng-grid-footer form-inline";n.splitByCamelCasing=function(n){var t=n.split(/(?=[A-Z])/);return t.length&&t[0].length&&(t[0]=t[0][0].toLocaleUpperCase()+t[0].substr(1)),t.join(" ")};var i=function(n,t){var r,i,u;for(t=t.toUpperCase(),r=n.children(),i=0;i<r.length;i++)if(u=r[i],u.tagName==t)return angular.element(u);return null},it=function(n,t){var r,u,i,f;for(t=t.toUpperCase(),r=[],u=n.children(),i=0;i<u.length;i++)f=u[i],f.tagName==t&&r.push(angular.element(f));return r},u=function(n,t,i){var r=[],u=t.slice(0);return angular.forEach(n,function(n){for(var t=null,i=0;!t&&i<u.length;i++)t=u[i],t.fieldName===n.fieldName?u.splice(i,1):t=null;t?r.push(angular.extend({},n,t)):r.push(angular.extend({},n))}),angular.forEach(u,function(n){n.isFieldColumn&&i||r.push(n)}),r},p=function(){function n(n,t){this.parent=n;this.cellElement=t;this.fieldName=t.attr(l);this.isFieldColumn=!!this.fieldName}return n}(),w=function(){function n(n,t,i){this.rowElement=n;this.cellTagName=t;this.cellDirectiveAttribute=i;this.cellTagName=this.cellTagName.toUpperCase();this.discoverCells()}return n.prototype.syncTemplateToColumnDefinitions=function(n){var t=this;angular.forEach(this.rowElement.children(),function(n){n.remove()});angular.forEach(u(n,this.extractPartialColumnDefinitions(),!0),function(n,i){var r,u;n instanceof p&&n.parent===t?(u=n,r=u.cellElement):r=angular.element("<table><"+t.cellTagName+"/><\/table>").find(t.cellTagName);r.attr(t.cellDirectiveAttribute,i);r.children().length>0&&r.attr(d,"true");n.isFieldColumn&&r.attr(l,n.fieldName);t.rowElement.append(r)})},n.prototype.extractPartialColumnDefinitions=function(){var n=[];return angular.forEach(this.cells,function(t){var i={isFieldColumn:t.isFieldColumn};t.isFieldColumn&&(i.fieldName=t.fieldName);n.push(i)}),n},n.prototype.discoverCells=function(){var n=this;this.cells=[];angular.forEach(this.rowElement.children(),function(t){n.isValidCell(t)&&n.cells.push(new p(n,t))})},n.prototype.isValidCell=function(n){return n[0].tagName===this.cellTagName&&typeof n.attr(k)=="undefined"},n}(),tt=function(){function r(i,r,u,f,e,o){var s=this,h;this.$compile=i;this.$parse=e;this.$timeout=o;this.gridElement=u;this.internalScope=r;r.TrNgGrid=n;h="gridOptions";this.gridOptions={items:[],selectedItems:[],filterBy:null,filterByFields:{},orderBy:null,orderByReverse:!1,pageItems:null,currentPage:0,totalItems:null,enableFiltering:!0,enableSorting:!0,enableSelections:!0,enableMultiRowSelections:!0,selectionMode:t[2],onDataRequiredDelay:1e3};this.gridOptions.onDataRequired=f.onDataRequired?r.onDataRequired:null;this.gridOptions.gridColumnDefs=[];this.internalScope[h]=this.gridOptions;this.externalScope=this.internalScope.$parent;this.linkScope(this.internalScope,this.externalScope,h,f);this.gridOptions.onDataRequired&&r.$watchCollection("[gridOptions.filterBy, gridOptions.filterByFields, gridOptions.orderBy, gridOptions.orderByReverse, gridOptions.currentPage]",function(){s.dataRequestPromise&&(s.$timeout.cancel(s.dataRequestPromise),s.dataRequestPromise=null);s.dataRequestPromise=s.$timeout(function(){s.dataRequestPromise=null;s.gridOptions.onDataRequired(s.gridOptions)},s.gridOptions.onDataRequiredDelay,!0)});this.internalScope.$watch(h+".enableMultiRowSelections",function(n,i){n!==i&&(n?(s.gridOptions.selectionMode=t[2],s.gridOptions.enableSelections=!0):s.gridOptions.enableSelections&&(s.gridOptions.selectionMode=t[1]))});this.internalScope.$watch(h+".enableSelections",function(n,i){n!==i&&(n?s.gridOptions.selectionMode===t[0]&&(s.gridOptions.selectionMode=t[1]):(s.gridOptions.enableMultiRowSelections=!1,s.gridOptions.selectionMode=t[0]))});this.internalScope.$watch(h+".selectionMode",function(n,i){if(n!==i)switch(n){case t[0]:s.gridOptions.selectedItems.splice(0);break;case t[1]:s.gridOptions.selectedItems.length>1&&s.gridOptions.selectedItems.splice(1)}})}return r.prototype.setColumnOptions=function(n,t){var i=this.gridOptions.gridColumnDefs[n];if(!i)throw"Invalid grid column options found for column index "+n+". Please report this error.";t=angular.extend(t,i);this.gridOptions.gridColumnDefs[n]=t},r.prototype.toggleSorting=function(n){this.gridOptions.orderBy!=n?this.gridOptions.orderBy=n:this.gridOptions.orderByReverse=!this.gridOptions.orderByReverse},r.prototype.setFilter=function(n,t){t?this.gridOptions.filterByFields[n]=t:delete this.gridOptions.filterByFields[n];this.gridOptions.filterByFields=$.extend({},this.gridOptions.filterByFields)},r.prototype.toggleItemSelection=function(n,i){var s,u,f,h,e,o,r;if(this.gridOptions.selectionMode!==t[0])switch(this.gridOptions.selectionMode){case t[3]:if(i.ctrlKey||i.shiftKey||i.metaKey){if(i.ctrlKey||i.metaKey)r=this.gridOptions.selectedItems.indexOf(n),r>=0?this.gridOptions.selectedItems.splice(r,1):this.gridOptions.selectedItems.push(n);else if(i.shiftKey){if(document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&(s=window.getSelection(),s.removeAllRanges()),u=-1,this.gridOptions.selectedItems.length>0&&(u=this.gridOptions.items.indexOf(this.gridOptions.selectedItems[this.gridOptions.selectedItems.length-1])),u<0&&(u=0),f=this.gridOptions.items.indexOf(n),f<0)throw"Invalid selection on a key modifier selection mode";for(f<u&&(h=u,u=f,f=h),e=u;e<=f;e++)o=this.gridOptions.items[e],this.gridOptions.selectedItems.indexOf(o)<0&&this.gridOptions.selectedItems.push(o)}}else r=this.gridOptions.selectedItems.indexOf(n),this.gridOptions.selectedItems.splice(0),r<0&&this.gridOptions.selectedItems.push(n);break;case t[1]:r=this.gridOptions.selectedItems.indexOf(n);this.gridOptions.selectedItems.splice(0);r<0&&this.gridOptions.selectedItems.push(n);break;case t[2]:r=this.gridOptions.selectedItems.indexOf(n);r>=0?this.gridOptions.selectedItems.splice(r,1):this.gridOptions.selectedItems.push(n)}},r.prototype.alignTableStructureToFields=function(){var c=this,h=this.gridElement,s;this.columnDefsItemsWatcherDeregistration&&(this.columnDefsItemsWatcherDeregistration(),this.columnDefsItemsWatcherDeregistration=null);var t=new w(i(i(h,"thead"),"tr"),"th",e),r=t.extractPartialColumnDefinitions(),f=new w(i(i(h,"tbody"),"tr"),"td",v),o=f.extractPartialColumnDefinitions(),n=[],l=typeof this.gridOptions.fields!="undefined";if(l)angular.forEach(this.gridOptions.fields,function(t){n.push({isFieldColumn:!0,fieldName:t})}),n=u(n,r,!0),n=u(n,o,!0);else if(r.length>0)n=u(r,o,!1);else{if(!this.gridOptions.items||this.gridOptions.items.length==0){this.columnDefsItemsWatcherDeregistration=this.internalScope.$watchCollection("gridOptions.items",function(){c.alignTableStructureToFields()});return}for(s in this.gridOptions.items[0])s.match(/^[_\$]/g)||n.push({isFieldColumn:!0,fieldName:s});n=u(n,o,!0)}this.gridOptions.gridColumnDefs=n;t.syncTemplateToColumnDefinitions(n);f.syncTemplateToColumnDefinitions(n);this.$compile(t.rowElement)(this.internalScope);this.$compile(f.rowElement)(this.internalScope)},r.prototype.linkScope=function(n,t,i,r){var f=n[i],u,o,s,e;for(u in f)if(o=typeof r[u]!="undefined"&&r[u]!=null,o){s=!1;typeof n[u]!="undefined"&&n[u]!=null&&(f[u]=n[u],s=f[u]instanceof Array);e=null;try{e=this.$parse(r[u])}catch(h){}(function(r,u){u&&u.constant||n.$watch(r,function(n,t){n!==t&&(f[r]=n)});var e=u&&u.assign?u.assign:null;e&&n.$watch(i+"."+r,function(n,i){n!==i&&e(t,n)})})(u,e)}},r}();angular.module("trNgGrid",[]).directive(r,[function(){return{restrict:"A",scope:{items:"=",selectedItems:"=?",filterBy:"=?",filterByFields:"=?",orderBy:"=?",orderByReverse:"=?",pageItems:"=?",currentPage:"=?",totalItems:"=?",enableFiltering:"=?",enableSorting:"=?",enableSelections:"=?",enableMultiRowSelections:"=?",selectionMode:"@",onDataRequired:"&",onDataRequiredDelay:"=?",fields:"=?"},controller:["$compile","$scope","$element","$attrs","$parse","$timeout",tt],compile:function(t){var o,r,s,u,f,h,c;t.addClass(n.tableCssClass);var l=!1,a=!1,e=i(t,"thead");return e||(e=angular.element("<table><thead><\/thead><\/table>").find("thead"),a=!0),o=i(e,"tr"),o||(o=angular.element("<table><tr><\/tr><\/table>").find("tr"),e.append(o)),r=i(t,"tbody"),r||(r=angular.element("<table><tbody><\/tbody><\/table>").find("tbody"),t.append(r)),s=i(r,"tr"),s||(s=angular.element("<table><tr><\/tr><\/table>").find("tr"),r.append(s)),u=i(t,"tfoot"),u||(u=angular.element("<table><tfoot><\/tfoot><\/table>").find("tfoot"),l=!0),f=i(u,"tr"),f||(f=angular.element("<table><tr><\/tr><\/table>").find("tr"),u.append(f)),i(f,"td")||(h=angular.element("<table><td><\/td><\/table>").find("td"),h.attr("colspan","999"),f.append(h),c=angular.element("<div>"),c.attr(g,""),h.append(c)),l&&t.prepend(u),a&&t.prepend(e),{pre:function(n,t,i,r){n.gridOptions=r.gridOptions;r.alignTableStructureToFields()}}}}}]).directive(f,["$compile",function(){return{restrict:"A",require:"^"+r,scope:{fieldName:"@",displayName:"@",enableFiltering:"=?",enableSorting:"=?",displayAlign:"=?",displayFormat:"=?",cellWidth:"@",cellHeight:"@",isCustomized:"=?",columnDefinitionIndex:"=?"+f},templateUrl:n.cellHeaderTemplateId,transclude:!0,compile:function(){return{pre:function(n,t,i,r){var u=n,f=n;r.setColumnOptions(f.columnDefinitionIndex,u);f.columnOptions=u}}}}}]).directive(h,[function(){return{restrict:"A",replace:!0,templateUrl:n.columnSortTemplateId}}]).directive(c,[function(){return{restrict:"A",replace:!0,templateUrl:n.columnFilterTemplateId}}]).directive("trNgGridBody",["$compile",function(t){return{restrict:"A",scope:!0,require:"^"+r,replace:!0,compile:function(i){var r=i.children("tr");return i.contents().remove(),{pre:function(i,u,f,o){i.gridOptions=o.gridOptions;i.toggleItemSelection=function(n,t){return o.toggleItemSelection(n,t)};i.$watchCollection("gridOptions.gridColumnDefs",function(f){var s="gridItem in gridOptions.items",o;i.gridOptions.onDataRequired||(s+=" | filter:gridOptions.filterBy | filter:gridOptions.filterByFields | orderBy:gridOptions.orderBy:gridOptions.orderByReverse | "+n.dataPagingFilter+":gridOptions");o=r.clone(!0);o.attr("ng-repeat",s);o.attr("ng-click")||o.attr("ng-click","toggleItemSelection(gridItem, $event)");o.attr("ng-class","{'"+n.rowSelectedCssClass+"':gridOptions.selectedItems.indexOf(gridItem)>=0}");o.attr(y,"{{$index}}");angular.forEach(f,function(t,i){var r=o.children("td:nth-child("+(i+1)+")"),h=r.attr("field-name"),s=!1,e,u,f;h!==t.fieldName?(s=!0,e=$("<td>"),r.length==0?o.append(e):r.before(e),r=e):s=r.text()=="";s&&(u=$("<div>").addClass(n.cellCssClass),t.fieldName?(u.attr("field-name",t.fieldName),f="{{gridItem."+t.fieldName,t.displayFormat&&(t.displayFormat[0]!="|"&&t.displayFormat[0]!="."&&(f+=" | "),f+=t.displayFormat),f+="}}",u.text(f)):u.text("Invalid column match inside the table body"),r.append(u));t.displayAlign&&r.addClass("text-"+t.displayAlign);t.cellWidth&&r.css("width",t.cellWidth);t.cellHeight&&r.css("height",t.cellHeight)});u.contents().remove();u.append(t(o)(i));u.removeAttr(b);u.children("td["+e+"]").removeAttr(e)})},post:function(){}}}}}]).directive(a,[function(){return{restrict:"A",scope:!1,require:"^"+r,replace:!0,templateUrl:n.footerTemplateId}}]).directive(o,[function(){return{restrict:"A",replace:!0,scope:!0,require:"^"+r,templateUrl:n.footerGlobalFilterTemplateId,compile:function(){return{pre:function(n,t,i,r){n.gridOptions=r.gridOptions},post:function(){}}}}}]).directive(s,[function(){var t=function(n,t){n.gridOptions=t.gridOptions;n.isPaged=!!n.gridOptions.pageItems;n.totalItemsCount=typeof n.gridOptions.totalItems!="undefined"&&n.gridOptions.totalItems!=null?n.gridOptions.totalItems:n.gridOptions.items?n.gridOptions.items.length:0;n.startItemIndex=n.isPaged?n.gridOptions.pageItems*n.gridOptions.currentPage:0;n.endItemIndex=n.isPaged?n.startItemIndex+n.gridOptions.pageItems-1:n.totalItemsCount-1;n.endItemIndex>=n.totalItemsCount&&(n.endItemIndex=n.totalItemsCount-1);n.endItemIndex<n.startItemIndex&&(n.endItemIndex=n.startItemIndex);n.lastPageIndex=!n.totalItemsCount||!n.isPaged?0:Math.floor(n.totalItemsCount/n.gridOptions.pageItems)+(n.totalItemsCount%n.gridOptions.pageItems?0:-1);n.pageIndexes=[];for(var i=0;i<=n.lastPageIndex;i++)n.pageIndexes.push(i);n.pageSelectionActive=n.pageIndexes.length>1;n.pageCanGoBack=n.isPaged&&n.gridOptions.currentPage>0;n.pageCanGoForward=n.isPaged&&n.gridOptions.currentPage<n.lastPageIndex;n.navigateToPage=function(t,i){n.gridOptions.currentPage=i;t.preventDefault();t.stopPropagation()};n.switchPageSelection=function(t,i){n.pageSelectionActive=i;t&&(t.preventDefault(),t.stopPropagation())}};return{restrict:"A",scope:!0,require:"^"+r,templateUrl:n.footerPagerTemplateId,replace:!0,link:{pre:function(n,i,r,u){t(n,u)},post:function(n,i,r,u){n.$watchCollection("[gridOptions.currentPage, gridOptions.items.length, gridOptions.totalItems, gridOptions.pageItems]",function(){t(n,u)})}}}}]).filter(n.dataPagingFilter,function(){return function(n,t){var i,r;return(n&&(t.totalItems=n.length),!t.pageItems||!n||n.length==0)?n:(t.currentPage||(t.currentPage=0),i=t.currentPage*t.pageItems,i>=n.length&&(t.currentPage=0,i=0),r=t.currentPage*t.pageItems+t.pageItems,n.slice(i,r))}}).filter(n.columnTitleDisplayNameFilter,function(){return function(t,i){return typeof t=="undefined"?n.splitByCamelCasing(i):t}}).run(["$templateCache",function(t){t.put(n.cellHeaderTemplateId,'<div class="'+n.columnContentsCssClass+'">  <div ng-if="!columnOptions.isCustomized">    <div class="'+n.columnTitleCssClass+'">      {{displayName |'+n.columnTitleDisplayNameFilter+":fieldName}}       <div "+n.columnSortDirectiveAttribute+" />    <\/div>    <div "+n.columnFilterDirectiveAttribute+'/>  <\/div>  <div ng-if="columnOptions.isCustomized">    <div ng-transclude/>  <\/div><\/div>');t.put(n.columnFilterTemplateId,"<div ng-show='enableFiltering||gridOptions.enableFiltering' class='"+n.columnFilterCssClass+"'> <div class='"+n.columnFilterInputWrapperCssClass+"'>   <input class='form-control input-sm' type='text' ng-model='filter'/> <\/div><\/div>");t.put(n.columnSortTemplateId,"<div ng-show='enableSorting||gridOptions.enableSorting' ng-click='toggleSorting(fieldName)' title='Sort' class='"+n.columnSortCssClass+"'>  <div ng-class=\"{'"+n.columnSortActiveCssClass+"':gridOptions.orderBy==fieldName,'"+n.columnSortInactiveCssClass+"':gridOptions.orderBy!=fieldName,'"+n.columnSortNormalOrderCssClass+"':gridOptions.orderBy!=fieldName||!gridOptions.orderByReverse,'"+n.columnSortReverseOrderCssClass+"':gridOptions.orderBy==fieldName&&gridOptions.orderByReverse}\" >  <\/div><\/div>");t.put(n.footerTemplateId,'<div class="'+n.footerCssClass+'">  <span '+n.globalFilterDirectiveAttribute+'=""/>  <span '+n.pagerDirectiveAttribute+'=""/><\/div>');t.put(n.footerGlobalFilterTemplateId,'<span ng-show="gridOptions.enableFiltering" class="pull-left form-group">  <input class="form-control" type="text" ng-model="gridOptions.filterBy" placeholder="Search"/><\/span>');t.put(n.footerPagerTemplateId,'<span class="pull-right form-group"> <ul class="pagination">   <li ng-show="pageCanGoBack" >     <a href="#" ng-click="navigateToPage($event, 0)" title="First Page">|&lArr;<\/a>   <\/li>   <li ng-show="pageCanGoBack" >     <a href="#" ng-click="navigateToPage($event, gridOptions.currentPage - 1)" title="Previous Page">&lArr;<\/a>   <\/li>   <li ng-show="pageSelectionActive" style="white-space: nowrap;">     <span>Page:        <select ng-model="gridOptions.currentPage" ng-options="pageIndex as (pageIndex+1) for pageIndex in pageIndexes"><\/select>     <\/span>   <\/li>   <li class="disabled" style="white-space: nowrap;">     <span ng-hide="totalItemsCount">No items to display<\/span>     <span ng-show="totalItemsCount" title="Select Page">       {{startItemIndex+1}} - {{endItemIndex+1}} displayed     <span>, {{totalItemsCount}} in total<\/span>     <\/span >    <\/li>   <li ng-show="pageCanGoForward">     <a href="#" ng-click="navigateToPage($event, gridOptions.currentPage + 1)" title="Next Page">&rArr;<\/a>   <\/li>   <li>   <li ng-show="pageCanGoForward">     <a href="#" ng-show="pageCanGoForward" ng-click="navigateToPage($event, lastPageIndex)" title="Last Page">&rArr;|<\/a>   <\/li> <\/ul><\/span>')}])})(TrNgGrid||(TrNgGrid={}));