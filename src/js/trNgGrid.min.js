"use strict";var TrNgGrid;(function(n){var u,s,h,c;(function(n){n[n.None=0]="None";n[n.SingleRow=1]="SingleRow";n[n.MultiRow=2]="MultiRow";n[n.MultiRowWithKeyModifiers=3]="MultiRowWithKeyModifiers"})(n.SelectionMode||(n.SelectionMode={}));var t=n.SelectionMode,i="trNgGrid",f="trNgGridHeader",l="tr-ng-grid-header";n.columnHeaderTemplateId=f+".html";var e="tr-ng-grid-body",a="tr-ng-grid-footer",v="tr-ng-grid-global-filter",y="tr-ng-grid-pager",r="tr-ng-grid-column",o="trNgGridColumnSort",p="tr-ng-grid-column-sort";n.columnSortTemplateId=o+".html";u="trNgGridColumnFilter";s="tr-ng-grid-column-filter";n.columnFilterTemplateId=u+".html";h="tr-ng-grid-row-page-item-index";n.tableCssClass="tr-ng-grid table table-bordered table-hover";n.cellCssClass="tr-ng-cell";n.columnHeaderContentsCssClass="tr-ng-column-header";n.titleCssClass="tr-ng-title";n.sortCssClass="tr-ng-sort";n.filterColumnCssClass="tr-ng-column-filter";n.filterInputWrapperCssClass="";n.sortActiveCssClass="tr-ng-sort-active text-info";n.sortInactiveCssClass="tr-ng-sort-inactive text-muted";n.sortReverseOrderCssClass="tr-ng-sort-order-reverse glyphicon glyphicon-chevron-up";n.sortNormalOrderCssClass="tr-ng-sort-order-normal glyphicon glyphicon-chevron-down";n.selectedRowCssClass="active";n.footerOpsContainerCssClass="tr-ng-grid-footer form-inline";c=function(){function n(n,i,r,u,f,e,o){var s=this,h;this.$compile=n;this.$parse=e;this.$timeout=o;this.gridElement=r;this.internalScope=i;this.scheduledRecompilationDereg=null;h="gridOptions";this.gridOptions={items:[],selectedItems:[],filterBy:null,filterByFields:{},orderBy:null,orderByReverse:!1,pageItems:null,currentPage:0,totalItems:null,enableFiltering:!0,enableSorting:!0,enableSelections:!0,enableMultiRowSelections:!0,selectionMode:t[2],onDataRequiredDelay:1e3};this.gridOptions.onDataRequired=u.onDataRequired?i.onDataRequired:null;this.gridOptions.gridColumnDefs=[];this.internalScope[h]=this.gridOptions;this.externalScope=this.internalScope.$parent;this.linkScope(this.internalScope,this.externalScope,h,u);this.gridOptions.onDataRequired&&i.$watchCollection("[gridOptions.filterBy, gridOptions.filterByFields, gridOptions.orderBy, gridOptions.orderByReverse, gridOptions.currentPage]",function(){s.dataRequestPromise&&(s.$timeout.cancel(s.dataRequestPromise),s.dataRequestPromise=null);s.dataRequestPromise=s.$timeout(function(){s.dataRequestPromise=null;s.gridOptions.onDataRequired(s.gridOptions)},s.gridOptions.onDataRequiredDelay,!0)});this.internalScope.$watch(h+".enableMultiRowSelections",function(n,i){n!==i&&(n?(s.gridOptions.selectionMode=t[2],s.gridOptions.enableSelections=!0):s.gridOptions.enableSelections&&(s.gridOptions.selectionMode=t[1]))});this.internalScope.$watch(h+".enableSelections",function(n,i){n!==i&&(n?s.gridOptions.selectionMode===t[0]&&(s.gridOptions.selectionMode=t[1]):(s.gridOptions.enableMultiRowSelections=!1,s.gridOptions.selectionMode=t[0]))});this.internalScope.$watch(h+".selectionMode",function(n,i){if(n!==i)switch(n){case t[0]:s.gridOptions.selectedItems.splice(0);break;case t[1]:s.gridOptions.selectedItems.length>1&&s.gridOptions.selectedItems.splice(1)}})}return n.prototype.setColumnOptions=function(n,t){n>=this.gridOptions.gridColumnDefs.length?(this.gridOptions.gridColumnDefs.push({}),this.setColumnOptions(n,t)):this.gridOptions.gridColumnDefs[n]=t},n.prototype.toggleSorting=function(n){this.gridOptions.orderBy!=n?this.gridOptions.orderBy=n:this.gridOptions.orderByReverse=!this.gridOptions.orderByReverse},n.prototype.setFilter=function(n,t){t?this.gridOptions.filterByFields[n]=t:delete this.gridOptions.filterByFields[n];this.gridOptions.filterByFields=$.extend({},this.gridOptions.filterByFields)},n.prototype.toggleItemSelection=function(n,i){var s,u,f,h,e,o,r;if(this.gridOptions.selectionMode!==t[0])switch(this.gridOptions.selectionMode){case t[3]:if(i.ctrlKey||i.shiftKey||i.metaKey){if(i.ctrlKey||i.metaKey)r=this.gridOptions.selectedItems.indexOf(n),r>=0?this.gridOptions.selectedItems.splice(r,1):this.gridOptions.selectedItems.push(n);else if(i.shiftKey){if(document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&(s=window.getSelection(),s.removeAllRanges()),u=-1,this.gridOptions.selectedItems.length>0&&(u=this.gridOptions.items.indexOf(this.gridOptions.selectedItems[this.gridOptions.selectedItems.length-1])),u<0&&(u=0),f=this.gridOptions.items.indexOf(n),f<0)throw"Invalid selection on a key modifier selection mode";for(f<u&&(h=u,u=f,f=h),e=u;e<=f;e++)o=this.gridOptions.items[e],this.gridOptions.selectedItems.indexOf(o)<0&&this.gridOptions.selectedItems.push(o)}}else r=this.gridOptions.selectedItems.indexOf(n),this.gridOptions.selectedItems.splice(0),r<0&&this.gridOptions.selectedItems.push(n);break;case t[1]:r=this.gridOptions.selectedItems.indexOf(n);this.gridOptions.selectedItems.splice(0);r<0&&this.gridOptions.selectedItems.push(n);break;case t[2]:r=this.gridOptions.selectedItems.indexOf(n);r>=0?this.gridOptions.selectedItems.splice(r,1):this.gridOptions.selectedItems.push(n)}},n.prototype.scheduleRecompilationOnAvailableItems=function(){var n=this;this.scheduledRecompilationDereg||this.gridOptions.items&&this.gridOptions.items.length||(this.scheduledRecompilationDereg=this.internalScope.$watch("items.length",function(t){t>0&&(n.scheduledRecompilationDereg(),n.$compile(n.gridElement)(n.externalScope))}))},n.prototype.linkScope=function(n,t,i,r){var f=n[i],u,o,s,e;for(u in f)if(o=typeof r[u]!="undefined"&&r[u]!=null,o){s=!1;typeof n[u]!="undefined"&&n[u]!=null&&(f[u]=n[u],s=f[u]instanceof Array);e=null;try{e=this.$parse(r[u])}catch(h){}(function(r,u){u&&u.constant||n.$watch(r,function(n,t){n!==t&&(f[r]=n)});var e=u&&u.assign?u.assign:null;e&&n.$watch(i+"."+r,function(n,i){n!==i&&e(t,n)})})(u,e)}},n.prototype.splitByCamelCasing=function(n){var t=n.split(/(?=[A-Z])/);return t.length&&t[0].length&&(t[0]=t[0][0].toLocaleUpperCase()+t[0].substr(1)),t.join(" ")},n}();angular.module("trNgGrid",[]).directive(i,[function(){return{restrict:"A",scope:{items:"=",selectedItems:"=?",filterBy:"=?",filterByFields:"=?",orderBy:"=?",orderByReverse:"=?",pageItems:"=?",currentPage:"=?",totalItems:"=?",enableFiltering:"=?",enableSorting:"=?",enableSelections:"=?",enableMultiRowSelections:"=?",selectionMode:"@",onDataRequired:"&",onDataRequiredDelay:"=?"},controller:["$compile","$scope","$element","$attrs","$transclude","$parse","$timeout",c],compile:function(t){var o,i,h,u,s,y,p;t.addClass(n.tableCssClass);var c=!1,v=!1,f=t.children("thead");f.length==0&&(f=$("<thead>"),v=!0);o=f.children("tr");o.length==0&&(o=$("<tr>").appendTo(f));o.attr(l,"");o.children("th[field-name]").attr(r,"");i=t.children("tbody");i.length===0&&(i=$("<tbody>").appendTo(t));h=i.children("tr");h.length===0&&(h=$("<tr>").appendTo(i));i.attr(e,"");u=t.children("tfoot");u.length==0&&(u=$("<tfoot>"),c=!0);s=u.children("tr");s.length==0&&(s=$("<tr>").appendTo(u));s.children("td").length==0&&(y=$("<td>").attr("colspan","999").appendTo(s),p=$("<div>").attr(a,"").appendTo(y));v&&t.prepend(f);c&&u.insertBefore(i)}}}]).directive(f,["$compile",function(n){return{restrict:"A",scope:!1,require:"^"+i,compile:function(){return{pre:function(t,i,u,f){var e,s,o,h;if(i.children("th").length==0)if(f.gridOptions.items&&f.gridOptions.items.length>0){e=[];for(s in f.gridOptions.items[0])s.match(/^[_\$]/g)||e.push(s);for(o=0;o<e.length;o++)h=$("<th>").attr(r,"").attr("field-name",e[o]).appendTo(i),n(h)(t)}else f.scheduleRecompilationOnAvailableItems()}}}}}]).directive("trNgGridColumn",["$compile",function(t){return{restrict:"A",scope:!0,require:"^"+i,compile:function(){var i;return{pre:function(n,t,u,f){var o=t.prop("tagName")=="TH",e;if(!o)throw"The template has an invalid header column template element. Column templates must be defined on TH elements inside THEAD/TR";(i=t.parent().children("th").index(t),i<0)||(n.gridOptions=f.gridOptions,n.toggleSorting=function(n){return f.toggleSorting(n)},n.filter="",n.$watch("filter",function(t,i){t!==i&&f.setFilter(n.currentGridColumnDef.fieldName,t)}),e=function(){n.currentGridColumnDef.fieldName=u.fieldName;n.currentGridColumnDef.displayName=typeof u.displayName=="undefined"?f.splitByCamelCasing(u.fieldName):u.displayName;n.currentGridColumnDef.enableFiltering=u.enableFiltering=="true"||typeof u.enableFiltering=="undefined"&&n.gridOptions.enableFiltering;n.currentGridColumnDef.enableSorting=u.enableSorting=="true"||typeof u.enableSorting=="undefined"&&n.gridOptions.enableSorting;n.currentGridColumnDef.displayAlign=u.displayAlign;n.currentGridColumnDef.displayFormat=u.displayFormat;n.currentGridColumnDef.cellWidth=u.cellWidth;n.currentGridColumnDef.cellHeight=u.cellHeight},n.currentGridColumnDef={},e(),n.$watchCollection("[gridOptions.enableFiltering,gridOptions.enableSorting]",function(){e()}),f.setColumnOptions(i,n.currentGridColumnDef),t.removeAttr(r))},post:function(i,r){if(i.currentGridColumnDef){if(!i.currentGridColumnDef.fieldName)throw"The column definition for trNgGrid must contain the field name";if(i.currentGridColumnDef.cellWidth&&r.css("width",i.currentGridColumnDef.cellWidth),i.currentGridColumnDef.cellHeight&&r.css("height",i.currentGridColumnDef.cellHeight),r.text()==""){var u=$("<div>").addClass(n.cellCssClass).addClass(n.columnHeaderContentsCssClass),f=$("<div>").addClass(n.titleCssClass).text(i.currentGridColumnDef.displayName).appendTo(u);$("<div>").attr(p,"").appendTo(f);$("<div>").attr(s,"").appendTo(u);r.append(t(u)(i))}}}}}}}]).directive(o,[function(){return{restrict:"A",replace:!0,templateUrl:n.columnSortTemplateId}}]).directive(u,[function(){return{restrict:"A",replace:!0,templateUrl:n.columnFilterTemplateId}}]).filter("paging",function(){return function(n,t){var i,r;return(n&&(t.totalItems=n.length),!t.pageItems||!n||n.length==0)?n:(t.currentPage||(t.currentPage=0),i=t.currentPage*t.pageItems,i>=n.length&&(t.currentPage=0,i=0),r=t.currentPage*t.pageItems+t.pageItems,n.slice(i,r))}}).directive("trNgGridBody",["$compile",function(t){return{restrict:"A",scope:!0,require:"^"+i,replace:!0,compile:function(i){var u=i.children("tr");return i.contents().remove(),{post:function(i,f,o,s){var l,c;i.gridOptions=s.gridOptions;i.toggleItemSelection=function(n,t){return s.toggleItemSelection(n,t)};l="gridItem in gridOptions.items";i.gridOptions.onDataRequired||(l+=" | filter:gridOptions.filterBy | filter:gridOptions.filterByFields | orderBy:gridOptions.orderBy:gridOptions.orderByReverse | paging:gridOptions");c=u.clone(!0);c.attr("ng-repeat",l);c.attr("ng-click")||c.attr("ng-click","toggleItemSelection(gridItem, $event)");c.attr("ng-class","{'"+n.selectedRowCssClass+"':gridOptions.selectedItems.indexOf(gridItem)>=0}");c.attr(h,"{{$index}}");angular.forEach(i.gridOptions.gridColumnDefs,function(t,i){var r=c.children("td:nth-child("+(i+1)+")"),s=r.attr("field-name"),o=!1,e,u,f;s!==t.fieldName?(o=!0,e=$("<td>"),r.length==0?c.append(e):r.before(e),r=e):o=r.text()=="";o&&(u=$("<div>").addClass(n.cellCssClass),t.fieldName?(u.attr("field-name",t.fieldName),f="{{gridItem."+t.fieldName,t.displayFormat&&(t.displayFormat[0]!="|"&&t.displayFormat[0]!="."&&(f+=" | "),f+=t.displayFormat),f+="}}",u.text(f)):u.text("Invalid column match inside the table body"),r.append(u));t.displayAlign&&r.addClass("text-"+t.displayAlign);t.cellWidth&&r.css("width",t.cellWidth);t.cellHeight&&r.css("height",t.cellHeight)});f.append(t(c)(i));f.removeAttr(e);f.children("td["+r+"]").removeAttr(r)}}}}}]).directive("trNgGridFooter",[function(){return{restrict:"A",scope:!1,require:"^"+i,replace:!0,template:'<div class="'+n.footerOpsContainerCssClass+'"><span '+v+'=""/><span '+y+'=""/><\/div>'}}]).directive("trNgGridGlobalFilter",[function(){return{restrict:"A",replace:!0,scope:!0,require:"^"+i,template:function(){return'<span ng-show="gridOptions.enableFiltering" class="pull-left form-group"><input class="form-control" type="text" ng-model="gridOptions.filterBy" placeholder="Search"/><\/span>'},compile:function(){return{pre:function(n,t,i,r){n.gridOptions=r.gridOptions},post:function(){}}}}}]).directive("trNgGridPager",[function(){var n=function(n,t){n.gridOptions=t.gridOptions;n.isPaged=!!n.gridOptions.pageItems;n.totalItemsCount=typeof n.gridOptions.totalItems!="undefined"&&n.gridOptions.totalItems!=null?n.gridOptions.totalItems:n.gridOptions.items?n.gridOptions.items.length:0;n.startItemIndex=n.isPaged?n.gridOptions.pageItems*n.gridOptions.currentPage:0;n.endItemIndex=n.isPaged?n.startItemIndex+n.gridOptions.pageItems-1:n.totalItemsCount-1;n.endItemIndex>=n.totalItemsCount&&(n.endItemIndex=n.totalItemsCount-1);n.endItemIndex<n.startItemIndex&&(n.endItemIndex=n.startItemIndex);n.lastPageIndex=!n.totalItemsCount||!n.isPaged?0:Math.floor(n.totalItemsCount/n.gridOptions.pageItems)+(n.totalItemsCount%n.gridOptions.pageItems?0:-1);n.pageIndexes=[];for(var i=0;i<=n.lastPageIndex;i++)n.pageIndexes.push(i);n.pageSelectionActive=n.pageIndexes.length>1;n.pageCanGoBack=n.isPaged&&n.gridOptions.currentPage>0;n.pageCanGoForward=n.isPaged&&n.gridOptions.currentPage<n.lastPageIndex;n.navigateToPage=function(t,i){n.gridOptions.currentPage=i;t.preventDefault();t.stopPropagation()};n.switchPageSelection=function(t,i){n.pageSelectionActive=i;t&&(t.preventDefault(),t.stopPropagation())}};return{restrict:"A",scope:!0,require:"^"+i,template:function(){return'<span class="pull-right form-group"><ul class="pagination"><li ng-show="pageCanGoBack" ><a href="#" ng-click="navigateToPage($event, 0)" title="First Page">|&lArr;<\/a><\/li><li ng-show="pageCanGoBack" ><a href="#" ng-click="navigateToPage($event, gridOptions.currentPage - 1)" title="Previous Page">&lArr;<\/a><\/li><li ng-show="pageSelectionActive" style="white-space: nowrap;"><span>Page: <select ng-model="gridOptions.currentPage" ng-options="pageIndex as (pageIndex+1) for pageIndex in pageIndexes"><\/select><\/span><\/li><li class="disabled" style="white-space: nowrap;"><span ng-hide="totalItemsCount">No items to display<\/span><span ng-show="totalItemsCount" title="Select Page">  {{startItemIndex+1}} - {{endItemIndex+1}} displayed<span>, {{totalItemsCount}} in total<\/span><\/span > <\/li><li ng-show="pageCanGoForward"><a href="#" ng-click="navigateToPage($event, gridOptions.currentPage + 1)" title="Next Page">&rArr;<\/a><\/li><li><li ng-show="pageCanGoForward"><a href="#" ng-show="pageCanGoForward" ng-click="navigateToPage($event, lastPageIndex)" title="Last Page">&rArr;|<\/a><\/li><\/ul><\/span>'},replace:!0,link:{pre:function(t,i,r,u){n(t,u)},post:function(t,i,r,u){t.$watchCollection("[gridOptions.currentPage, gridOptions.items.length, gridOptions.totalItems, gridOptions.pageItems]",function(){n(t,u)})}}}}]).run(["$templateCache",function(t){t.put(n.columnFilterTemplateId,"<div ng-show='currentGridColumnDef.enableFiltering' class='"+n.filterColumnCssClass+"'><div class='"+n.filterInputWrapperCssClass+"'><input class='form-control input-sm' type='text' ng-model='filter'/><\/div><\/div>");t.put(n.columnSortTemplateId,"<div ng-show='currentGridColumnDef.enableSorting' ng-click='toggleSorting(currentGridColumnDef.fieldName)' title='Sort' class='"+n.sortCssClass+"'><div ng-class=\"{'"+n.sortActiveCssClass+"':gridOptions.orderBy==currentGridColumnDef.fieldName,'"+n.sortInactiveCssClass+"':gridOptions.orderBy!=currentGridColumnDef.fieldName,'"+n.sortNormalOrderCssClass+"':gridOptions.orderBy!=currentGridColumnDef.fieldName||!gridOptions.orderByReverse,'"+n.sortReverseOrderCssClass+"':gridOptions.orderBy==currentGridColumnDef.fieldName&&gridOptions.orderByReverse}\"  ><\/div><\/div>")}])})(TrNgGrid||(TrNgGrid={}));