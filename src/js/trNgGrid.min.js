var TrNgGrid;(function(e){var k="trNgGrid";var g="trNgGridHeader";var d="tr-ng-grid-header";var w="trNgGridBody";var C="tr-ng-grid-body";var D="trNgGridFooter";var l="tr-ng-grid-footer";var h="trNgGridGlobalFilter";var v="tr-ng-grid-global-filter";var x="trNgGridPager";var p="tr-ng-grid-pager";var u="trNgGridColumn";var j="tr-ng-grid-column";var f="trNgGridColumnSort";var F="tr-ng-grid-column-sort";var c="trNgGridColumnFilter";var o="tr-ng-grid-column-filter";var i="tr-ng-grid-row-page-item-index";var A="tr-ng-grid table table-bordered table-hover";var n="tr-ng-cell";var t="";var a="tr-ng-title";var y="tr-ng-sort";var m="tr-ng-column-filter";var B="";var b="tr-ng-sort-active";var z="tr-ng-sort-inactive";var r="tr-ng-sort-reverse";var s="active";var E="tr-ng-grid-footer form-inline";var q=(function(){function G(J,O,P,N,M,I,H){var K=this;this.$compile=J;this.$parse=I;this.$timeout=H;this.gridElement=P;this.internalScope=O;this.scheduledRecompilationDereg=null;var L="gridOptions";this.gridOptions={items:[],selectedItems:[],filterBy:null,filterByFields:{},orderBy:null,orderByReverse:false,pageItems:null,currentPage:0,totalItems:null,enableFiltering:true,enableSorting:true,enableSelections:true,enableMultiRowSelections:true,onDataRequiredDelay:1000};this.gridOptions.onDataRequired=N.onDataRequired?O.onDataRequired:null;this.gridOptions.gridColumnDefs=[];O[L]=this.gridOptions;this.externalScope=this.internalScope.$parent;this.linkScope(this.internalScope,L,N);if(this.gridOptions.onDataRequired){O.$watchCollection("[gridOptions.filterBy, gridOptions.filterByFields, gridOptions.orderBy, gridOptions.orderByReverse, gridOptions.currentPage]",function(){if(K.dataRequestPromise){K.$timeout.cancel(K.dataRequestPromise);K.dataRequestPromise=null}K.dataRequestPromise=K.$timeout(function(){K.dataRequestPromise=null;K.gridOptions.onDataRequired(K.gridOptions)},K.gridOptions.onDataRequiredDelay,true)})}this.internalScope.$watch("enableMultiRowSelections",function(R,Q){if(R!==Q&&!R){if(K.gridOptions.selectedItems.length>1){K.gridOptions.selectedItems.splice(1)}}});this.internalScope.$watch("enableSelections",function(R,Q){if(R!==Q&&!R){K.gridOptions.selectedItems.splice(0);K.gridOptions.enableMultiRowSelections=false}})}G.prototype.setColumnOptions=function(H,I){if(H>=this.gridOptions.gridColumnDefs.length){this.gridOptions.gridColumnDefs.push({});this.setColumnOptions(H,I)}else{this.gridOptions.gridColumnDefs[H]=I}};G.prototype.toggleSorting=function(H){if(this.gridOptions.orderBy!=H){this.gridOptions.orderBy=H}else{this.gridOptions.orderByReverse=!this.gridOptions.orderByReverse}};G.prototype.setFilter=function(H,I){if(!I){delete (this.gridOptions.filterByFields[H])}else{this.gridOptions.filterByFields[H]=I}this.gridOptions.filterByFields=$.extend({},this.gridOptions.filterByFields)};G.prototype.toggleItemSelection=function(I){if(!this.gridOptions.enableSelections){return}var H=this.gridOptions.selectedItems.indexOf(I);if(H>=0){this.gridOptions.selectedItems.splice(H,1)}else{if(!this.gridOptions.enableMultiRowSelections){this.gridOptions.selectedItems.splice(0)}this.gridOptions.selectedItems.push(I)}};G.prototype.scheduleRecompilationOnAvailableItems=function(){var H=this;if(this.scheduledRecompilationDereg||(this.gridOptions.items&&this.gridOptions.items.length)){return}this.scheduledRecompilationDereg=this.internalScope.$watch("items.length",function(J,I){if(J>0){H.scheduledRecompilationDereg();H.$compile(H.gridElement)(H.externalScope)}})};G.prototype.linkScope=function(P,H,M){var K=P[H];for(var I in K){var O=typeof(M[I])!="undefined"&&M[I]!=null;if(O){var J=false;if(typeof(P[I])!="undefined"&&P[I]!=null){K[I]=P[I];J=K[I] instanceof Array}if(!J){var N=this.$parse(M[I]);var L=typeof(N)!="array"&&N&&N.assign;if(L){(function(Q){P.$watch(H+"."+Q,function(S,R){if(S!==R){P[Q]=K[Q]}});P.$watch(Q,function(S,R){if(S!==R){K[Q]=P[Q]}})})(I)}}}}};G.prototype.splitByCamelCasing=function(I){var H=I.split(/(?=[A-Z])/);if(H.length&&H[0].length){H[0]=H[0][0].toLocaleUpperCase()+H[0].substr(1)}return H.join(" ")};return G})();angular.module("trNgGrid",[]).directive(k,[function(){return{restrict:"A",scope:{items:"=",selectedItems:"=?",filterBy:"=?",filterByFields:"=?",orderBy:"=?",orderByReverse:"=?",pageItems:"=?",currentPage:"=?",totalItems:"=?",enableFiltering:"=?",enableSorting:"=?",enableSelections:"=?",enableMultiRowSelections:"=?",onDataRequired:"&",onDataRequiredDelay:"=?"},controller:["$compile","$scope","$element","$attrs","$transclude","$parse","$timeout",q],compile:function(K,I){K.addClass(A);var N=false;var R=false;var G=K.children("thead");if(G.length==0){G=$("<thead>");R=true}var P=G.children("tr");if(P.length==0){P=$("<tr>").appendTo(G)}P.attr(d,"");P.children("th[field-name]").attr(j,"");var L=K.children("tbody");if(L.length===0){L=$("<tbody>").appendTo(K)}var M=L.children("tr");if(M.length===0){M=$("<tr>").appendTo(L)}L.attr(C,"");var Q=K.children("tfoot");if(Q.length==0){Q=$("<tfoot>");N=true}var O=Q.children("tr");if(O.length==0){O=$("<tr>").appendTo(Q)}if(O.children("td").length==0){var H=$("<td>").attr("colspan","999").appendTo(O);var J=$("<div>").attr(l,"").appendTo(H)}if(R){K.prepend(G)}if(N){Q.insertBefore(L)}}}}]).directive(g,["$compile",function(G){return{restrict:"A",scope:false,require:"^"+k,compile:function(I,H){return{pre:function(K,N,J,M){if(N.children("th").length==0){if(M.gridOptions.items&&M.gridOptions.items.length>0){for(var L in M.gridOptions.items[0]){if(!L.match(/^[_\$]/g)){var O=$("<th>").attr(j,"").attr("field-name",L).appendTo(N);G(O)(K)}}}else{M.scheduleRecompilationOnAvailableItems()}}}}}}}]).directive(u,["$compile",function(G){return{restrict:"A",scope:true,require:"^"+k,compile:function(J,I){var H;return{pre:function(M,P,L,K){var O=P.prop("tagName")=="TH";if(!O){throw"The template has an invalid header column template element. Column templates must be defined on TH elements inside THEAD/TR"}H=P.parent().children("th").index(P);if(H<0){return}M.gridOptions=K.gridOptions;M.toggleSorting=function(Q){return K.toggleSorting(Q)};M.filter="";M.$watch("filter",function(R,Q){if(R!==Q){K.setFilter(M.currentGridColumnDef.fieldName,R)}});var N=function(){M.currentGridColumnDef.fieldName=L.fieldName;M.currentGridColumnDef.displayName=typeof(L.displayName)=="undefined"?K.splitByCamelCasing(L.fieldName):L.displayName,M.currentGridColumnDef.enableFiltering=L.enableFiltering=="true"||(typeof(L.enableFiltering)=="undefined"&&M.gridOptions.enableFiltering);M.currentGridColumnDef.enableSorting=L.enableSorting=="true"||(typeof(L.enableSorting)=="undefined"&&M.gridOptions.enableSorting);M.currentGridColumnDef.displayAlign=L.displayAlign;M.currentGridColumnDef.displayFormat=L.displayFormat;M.currentGridColumnDef.cellWidth=L.cellWidth;M.currentGridColumnDef.cellHeight=L.cellHeight};M.currentGridColumnDef={};N();M.$watchCollection("[gridOptions.enableFiltering,gridOptions.enableSorting]",function(R,Q){N()});K.setColumnOptions(H,M.currentGridColumnDef);P.removeAttr(j)},post:function(M,O,L,K){if(M.currentGridColumnDef){if(!M.currentGridColumnDef.fieldName){throw"The column definition for trNgGrid must contain the field name"}if(M.currentGridColumnDef.cellWidth){O.css("width",M.currentGridColumnDef.cellWidth)}if(M.currentGridColumnDef.cellHeight){O.css("height",M.currentGridColumnDef.cellHeight)}if(O.text()==""){var P=$("<div>").addClass(n);var N=$("<div>").addClass(t).appendTo(P);$("<div>").addClass(a).text(M.currentGridColumnDef.displayName).appendTo(N);$("<div>").attr(F,"").appendTo(N);$("<div>").attr(o,"").appendTo(P);O.append(G(P)(M))}}}}}}}]).directive(f,[function(){return{restrict:"A",replace:true,template:function(H,G){return"<div ng-show='currentGridColumnDef.enableSorting' ng-click='toggleSorting(currentGridColumnDef.fieldName)' title='Sort' class='"+y+"'><div ng-class=\"{'"+b+"':gridOptions.orderBy==currentGridColumnDef.fieldName,'"+z+"':gridOptions.orderBy!=currentGridColumnDef.fieldName,'"+r+"':gridOptions.orderByReverse}\"  ></div></div>"}}}]).directive(c,[function(){return{restrict:"A",replace:true,template:function(H,G){return"<div ng-show='currentGridColumnDef.enableFiltering' class='"+m+"'><div class='"+B+"'><input class='form-control input-sm' type='text' ng-model='filter'/></div></div>"},link:function(I,J,H,G){}}}]).filter("paging",function(){return function(G,I){if(G){I.totalItems=G.length}if(!I.pageItems||!G||G.length==0){return G}if(!I.currentPage){I.currentPage=0}var J=I.currentPage*I.pageItems;if(J>=G.length){I.currentPage=0;J=0}var H=I.currentPage*I.pageItems+I.pageItems;return G.slice(J,H)}}).directive(w,["$compile",function(G){return{restrict:"A",scope:true,require:"^"+k,replace:false,compile:function(J,I){var H=J.children("tr");J.contents().remove();return{post:function(M,O,L,K){M.gridOptions=K.gridOptions;M.toggleItemSelection=function(P){return K.toggleItemSelection(P)};var N="gridItem in gridOptions.items";if(M.gridOptions.onDataRequired){}else{N+=" | filter:gridOptions.filterBy | filter:gridOptions.filterByFields | orderBy:gridOptions.orderBy:gridOptions.orderByReverse | paging:gridOptions"}H.attr("ng-repeat",N);if(!H.attr("ng-click")){H.attr("ng-click","toggleItemSelection(gridItem)")}H.attr("ng-class","{'"+s+"':gridOptions.selectedItems.indexOf(gridItem)>=0}");H.attr(i,"{{$index}}");angular.forEach(M.gridOptions.gridColumnDefs,function(W,Q){var P=H.children("td:nth-child("+(Q+1)+")");var T=P.attr("field-name");var V=false;if(T!==W.fieldName){V=true;var R=$("<td>");if(P.length==0){H.append(R)}else{P.before(R)}P=R}else{V=(P.text()=="")}if(V){var U=$("<div>").addClass(n);if(W.fieldName){U.attr("field-name",W.fieldName);var S="{{gridItem."+W.fieldName;if(W.displayFormat){if(W.displayFormat[0]!="|"&&W.displayFormat[0]!="."){S+=" | "}S+=W.displayFormat}S+="}}";U.text(S)}else{U.text("Invalid column match inside the table body")}P.append(U)}if(W.displayAlign){P.addClass("text-"+W.displayAlign)}if(W.cellWidth){P.css("width",W.cellWidth)}if(W.cellHeight){P.css("height",W.cellHeight)}});H.children("td["+j+"]").removeAttr(j);H.removeAttr(C);O.append(G(H)(M))}}}}}]).directive(D,[function(){return{restrict:"A",scope:false,require:"^"+k,replace:true,template:'<div class="'+E+'"><span '+v+'=""/><span '+p+'=""/></div>'}}]).directive(h,[function(){return{restrict:"A",replace:true,scope:true,require:"^"+k,template:function(H,G){return'<span ng-show="gridOptions.enableFiltering" class="pull-left form-group"><input class="form-control" type="text" ng-model="gridOptions.filterBy" placeholder="Search"/></span>'},compile:function(H,G){return{pre:function(K,L,J,I){K.gridOptions=I.gridOptions},post:function(K,L,J,I){}}}}}]).directive(x,[function(){var G=function(I,H){I.gridOptions=H.gridOptions;I.isPaged=!!I.gridOptions.pageItems;I.totalItemsCount=(typeof(I.gridOptions.totalItems)!="undefined"&&I.gridOptions.totalItems!=null)?I.gridOptions.totalItems:(I.gridOptions.items?I.gridOptions.items.length:0);I.startItemIndex=I.isPaged?(I.gridOptions.pageItems*I.gridOptions.currentPage):0;I.endItemIndex=I.isPaged?(I.startItemIndex+I.gridOptions.pageItems-1):I.totalItemsCount-1;if(I.endItemIndex>=I.totalItemsCount){I.endItemIndex=I.totalItemsCount-1}if(I.endItemIndex<I.startItemIndex){I.endItemIndex=I.startItemIndex}I.pageCanGoBack=I.isPaged&&I.gridOptions.currentPage>0;I.pageCanGoForward=I.isPaged&&I.endItemIndex<I.totalItemsCount-1;I.navigateNextPage=function(J){I.gridOptions.currentPage=I.gridOptions.currentPage+1;J.preventDefault();J.stopPropagation()};I.navigatePrevPage=function(J){I.gridOptions.currentPage=I.gridOptions.currentPage-1;J.preventDefault();J.stopPropagation()}};return{restrict:"A",scope:true,require:"^"+k,template:function(I,H){return'<span class="pull-right form-group"><ul class="pagination"><li><a href="#" ng-show="pageCanGoBack" ng-click="navigatePrevPage($event)" title="Previous Page">&lArr;</a></li><li class="disabled" style="white-space: nowrap;"><span ng-hide="totalItemsCount">No items to display</span><span ng-show="totalItemsCount">  {{startItemIndex+1}} - {{endItemIndex+1}} displayed<span>, {{totalItemsCount}} in total</span></span></li><li><a href="#" ng-show="pageCanGoForward" ng-click="navigateNextPage($event)" title="Next Page">&rArr;</a><li></ul></span>'},replace:true,link:{pre:function(J,K,I,H){G(J,H)},post:function(J,K,I,H){J.$watchCollection("[gridOptions.currentPage, gridOptions.items.length, gridOptions.totalItems, gridOptions.pageItems]",function(M,L){G(J,H)})}}}}])})(TrNgGrid||(TrNgGrid={}));