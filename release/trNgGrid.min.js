var TrNgGrid;(function(e){var k="trNgGrid";var g="trNgGridHeader";var d="tr-ng-grid-header";var v="trNgGridBody";var A="tr-ng-grid-body";var B="trNgGridFooter";var l="tr-ng-grid-footer";var h="trNgGridGlobalFilter";var u="tr-ng-grid-global-filter";var w="trNgGridPager";var p="tr-ng-grid-pager";var t="trNgGridColumn";var j="tr-ng-grid-column";var f="trNgGridColumnSort";var D="tr-ng-grid-column-sort";var c="trNgGridColumnFilter";var o="tr-ng-grid-column-filter";var i="tr-ng-grid-row-page-item-index";var z="tr-ng-grid table table-bordered table-hover";var n="tr-ng-cell";var a="tr-ng-title";var x="tr-ng-sort btn btn-default";var m="tr-ng-column-filter";var b="tr-ng-sort-active";var y="tr-ng-sort-inactive";var r="tr-ng-sort-reverse";var s="active";var C="navbar navbar-default";var q=(function(){function E(H,M,N,L,K,G,F){var I=this;this.$compile=H;this.$parse=G;this.$timeout=F;this.gridElement=N;this.internalScope=M;this.scheduledRecompilationDereg=null;var J="gridOptions";this.gridOptions={items:[],selectedItems:[],filterBy:null,filterByFields:{},orderBy:null,orderByReverse:false,pageItems:null,currentPage:0,totalItems:null,enableFiltering:true,enableSorting:true,enableSelections:true,enableMultiRowSelections:true,onDataRequiredDelay:1000};this.gridOptions.onDataRequired=L.onDataRequired?M.onDataRequired:null;this.gridOptions.gridColumnDefs=[];M[J]=this.gridOptions;this.externalScope=this.internalScope.$parent;this.linkScope(this.internalScope,J,L);if(this.gridOptions.onDataRequired){M.$watchCollection("[gridOptions.filterBy, gridOptions.filterByFields, gridOptions.orderBy, gridOptions.orderByReverse, gridOptions.currentPage]",function(){if(I.dataRequestPromise){I.$timeout.cancel(I.dataRequestPromise);I.dataRequestPromise=null}I.dataRequestPromise=I.$timeout(function(){I.dataRequestPromise=null;I.gridOptions.onDataRequired(I.gridOptions)},I.gridOptions.onDataRequiredDelay,true)})}this.internalScope.$watch("enableMultiRowSelections",function(P,O){if(P!==O&&!P){if(I.gridOptions.selectedItems.length>1){I.gridOptions.selectedItems.splice(1)}}});this.internalScope.$watch("enableSelections",function(P,O){if(P!==O&&!P){I.gridOptions.selectedItems.splice(0);I.gridOptions.enableMultiRowSelections=false}})}E.prototype.setColumnOptions=function(F,G){if(F>=this.gridOptions.gridColumnDefs.length){this.gridOptions.gridColumnDefs.push({});this.setColumnOptions(F,G)}else{this.gridOptions.gridColumnDefs[F]=G}};E.prototype.toggleSorting=function(F){if(this.gridOptions.orderBy!=F){this.gridOptions.orderBy=F}else{this.gridOptions.orderByReverse=!this.gridOptions.orderByReverse}};E.prototype.setFilter=function(F,G){if(!G){delete (this.gridOptions.filterByFields[F])}else{this.gridOptions.filterByFields[F]=G}this.gridOptions.filterByFields=$.extend({},this.gridOptions.filterByFields)};E.prototype.setCellStyle=function(F,G){if(G.cellWidth){F.css("width",G.cellWidth)}if(G.cellHeight){F.css("height",G.cellHeight)}};E.prototype.toggleItemSelection=function(G){if(!this.gridOptions.enableSelections){return}var F=this.gridOptions.selectedItems.indexOf(G);if(F>=0){this.gridOptions.selectedItems.splice(F,1)}else{if(!this.gridOptions.enableMultiRowSelections){this.gridOptions.selectedItems.splice(0)}this.gridOptions.selectedItems.push(G)}};E.prototype.scheduleRecompilationOnAvailableItems=function(){var F=this;if(this.scheduledRecompilationDereg||(this.gridOptions.items&&this.gridOptions.items.length)){return}this.scheduledRecompilationDereg=this.internalScope.$watch("items.length",function(H,G){if(H>0){F.scheduledRecompilationDereg();F.$compile(F.gridElement)(F.externalScope)}})};E.prototype.linkScope=function(N,F,K){var I=N[F];for(var G in I){var M=typeof(K[G])!="undefined"&&K[G]!=null;if(M){var H=false;if(typeof(N[G])!="undefined"&&N[G]!=null){I[G]=N[G];H=I[G] instanceof Array}if(!H){var L=this.$parse(K[G]);var J=typeof(L)!="array"&&L&&L.assign;if(J){(function(O){N.$watch(F+"."+O,function(Q,P){if(Q!==P){N[O]=I[O]}});N.$watch(O,function(Q,P){if(Q!==P){I[O]=N[O]}})})(G)}}}}};E.prototype.splitByCamelCasing=function(G){var F=G.split(/(?=[A-Z])/);if(F.length&&F[0].length){F[0]=F[0][0].toLocaleUpperCase()+F[0].substr(1)}return F.join(" ")};return E})();angular.module("trNgGrid",[]).directive(k,[function(){return{restrict:"A",scope:{items:"=",selectedItems:"=?",filterBy:"=?",filterByFields:"=?",orderBy:"=?",orderByReverse:"=?",pageItems:"=?",currentPage:"=?",totalItems:"=?",enableFiltering:"=?",enableSorting:"=?",enableSelections:"=?",enableMultiRowSelections:"=?",onDataRequired:"&",onDataRequiredDelay:"=?"},controller:["$compile","$scope","$element","$attrs","$transclude","$parse","$timeout",q],compile:function(I,G){I.addClass(z);var L=false;var P=false;var E=I.children("thead");if(E.length==0){E=$("<thead>");P=true}var N=E.children("tr");if(N.length==0){N=$("<tr>").appendTo(E)}N.attr(d,"");var J=I.children("tbody");if(J.length===0){J=$("<tbody>").appendTo(I)}var K=J.children("tr");if(K.length===0){K=$("<tr>").appendTo(J)}J.attr(A,"");var O=I.children("tfoot");if(O.length==0){O=$("<tfoot>");L=true}var M=O.children("tr");if(M.length==0){M=$("<tr>").appendTo(O)}if(M.children("td").length==0){var F=$("<td>").attr("colspan","999").appendTo(M);var H=$("<div>").attr(l,"").appendTo(F)}if(P){I.prepend(E)}if(L){O.insertBefore(J)}}}}]).directive(B,[function(){return{restrict:"A",scope:false,require:"^"+k,replace:true,template:'<div class="'+C+'"><div '+u+'=""/><div '+p+'=""/></div>'}}]).directive(g,["$compile",function(E){return{restrict:"A",scope:false,require:"^"+k,compile:function(G,F){return{pre:function(I,L,H,K){if(L.children("th").length==0){if(K.gridOptions.items&&K.gridOptions.items.length>0){for(var J in K.gridOptions.items[0]){if(!J.match(/^[_\$]/g)){var M=$("<th>").attr(j,"").attr("field-name",J).appendTo(L);E(M)(I)}}}else{K.scheduleRecompilationOnAvailableItems()}}}}}}}]).directive(t,["$compile",function(E){return{restrict:"A",scope:true,require:"^"+k,compile:function(H,G){var F;return{pre:function(K,N,J,I){var M=N.prop("tagName")=="TH";if(!M){throw"The template has an invalid header column template element. Column templates must be defined on TH elements inside THEAD/TR"}F=N.parent().children("th").index(N);if(F<0){return}K.gridOptions=I.gridOptions;K.toggleSorting=function(O){return I.toggleSorting(O)};K.filter="";K.$watch("filter",function(P,O){if(P!==O){I.setFilter(K.currentGridColumnDef.fieldName,P)}});var L=function(){K.currentGridColumnDef.fieldName=J.fieldName;K.currentGridColumnDef.enableFiltering=J.enableFiltering=="true"||(typeof(J.enableFiltering)=="undefined"&&K.gridOptions.enableFiltering);K.currentGridColumnDef.enableSorting=J.enableSorting=="true"||(typeof(J.enableSorting)=="undefined"&&K.gridOptions.enableSorting);K.currentGridColumnDef.cellWidth=J.cellWidth;K.currentGridColumnDef.cellHeight=J.cellHeight};K.currentGridColumnDef={};L();K.$watchCollection("[gridOptions.enableFiltering,gridOptions.enableSorting]",function(P,O){L()});I.setColumnOptions(F,K.currentGridColumnDef);N.removeAttr(j)},post:function(K,L,J,I){if(K.currentGridColumnDef){if(!K.currentGridColumnDef.fieldName){throw"The column definition for trNgGrid must contain the field name"}I.setCellStyle(L,K.currentGridColumnDef);if(L.text()==""){var M=$("<div>").addClass(n);$("<span>").addClass(a).text(I.splitByCamelCasing(K.currentGridColumnDef.fieldName)).appendTo(M);$("<span>").attr(D,"").appendTo(M);$("<div>").attr(o,"").appendTo(M);L.append(E(M)(K))}}}}}}}]).directive(f,[function(){return{restrict:"A",replace:true,template:function(F,E){return"<div ng-show='currentGridColumnDef.enableSorting' ng-click='toggleSorting(currentGridColumnDef.fieldName)' title='Sort' class='"+x+"'><span ng-class=\"{'"+b+"':gridOptions.orderBy==currentGridColumnDef.fieldName,'"+y+"':gridOptions.orderBy!=currentGridColumnDef.fieldName,'"+r+"':gridOptions.orderByReverse}\"  ></span></div>"}}}]).directive(c,[function(){return{restrict:"A",replace:true,template:function(F,E){return"<div ng-show='currentGridColumnDef.enableFiltering' class='"+m+"'><input class='form-control input-sm' type='text' ng-model='filter'/></div>"},link:function(G,H,F,E){}}}]).filter("paging",function(){return function(E,F,I){if(!I||!E||E.length==0){return E}if(!F){F=0}var H=F*I;var G=F*I+I;if(H>=E.length){return E}return E.slice(H,G)}}).directive(v,["$compile",function(E){return{restrict:"A",scope:true,require:"^"+k,replace:false,compile:function(H,G){var F=H.children("tr");H.contents().remove();return{post:function(K,M,J,I){K.gridOptions=I.gridOptions;K.toggleItemSelection=function(N){return I.toggleItemSelection(N)};var L="gridItem in gridOptions.items";if(K.gridOptions.onDataRequired){}else{L+=" | filter:gridOptions.filterBy | filter:gridOptions.filterByFields | orderBy:gridOptions.orderBy:gridOptions.orderByReverse | paging:gridOptions.currentPage:gridOptions.pageItems"}F.attr("ng-repeat",L);if(!F.attr("ng-click")){F.attr("ng-click","toggleItemSelection(gridItem)")}F.attr("ng-class","{'"+s+"':gridOptions.selectedItems.indexOf(gridItem)>=0}");F.attr(i,"{{$index}}");angular.forEach(K.gridOptions.gridColumnDefs,function(R,O){var N=F.children("td:nth-child("+(O+1)+")");var Q=N.is("["+j+"]");if((Q&&!R.fieldName)||(!Q&&R.fieldName)){var P=$("<div>").addClass(n);if(R.fieldName){P.attr(j);P.text("{{gridItem."+R.fieldName+"}}")}else{P.text("Invalid column match inside the table body")}P=$("<td>").append(P);if(N.length==0){F.append(P)}else{N.before(P)}N=P}I.setCellStyle(N,R)});F.children("td["+j+"]").removeAttr(j);F.removeAttr(A);M.append(E(F)(K))}}}}}]).directive(h,[function(){return{restrict:"A",replace:true,scope:true,require:"^"+k,template:function(F,E){return'<div ng-show="gridOptions.enableFiltering" class="navbar-form navbar-left"><input class="form-control" type="text" ng-model="gridOptions.filterBy" placeholder="Search"/></div>'},compile:function(F,E){return{pre:function(I,J,H,G){I.gridOptions=G.gridOptions},post:function(I,J,H,G){}}}}}]).directive(w,[function(){var E=function(G,F){G.gridOptions=F.gridOptions;G.isPaged=!!G.gridOptions.pageItems;G.totalItemsCount=(typeof(G.gridOptions.totalItems)!="undefined"&&G.gridOptions.totalItems!=null)?G.gridOptions.totalItems:(G.gridOptions.items?G.gridOptions.items.length:0);G.startItemIndex=G.isPaged?(G.gridOptions.pageItems*G.gridOptions.currentPage):0;G.endItemIndex=G.isPaged?(G.startItemIndex+G.gridOptions.pageItems-1):G.totalItemsCount-1;if(G.endItemIndex>=G.totalItemsCount){G.endItemIndex=G.totalItemsCount-1}if(G.endItemIndex<G.startItemIndex){G.endItemIndex=G.startItemIndex}G.pageCanGoBack=G.isPaged&&G.gridOptions.currentPage>0;G.pageCanGoForward=G.isPaged&&G.endItemIndex<G.totalItemsCount-1};return{restrict:"A",scope:true,require:"^"+k,template:function(G,F){return'<div class="navbar-left"><button ng-show="pageCanGoBack" ng-click="gridOptions.currentPage=gridOptions.currentPage-1" type="button" class="btn btn-default navbar-btn navbar-left" title="Previous Page">&lArr;</button><p class="navbar-text navbar-left" style="white-space: nowrap;"><span ng-hide="totalItemsCount">No items to display</span><span ng-show="totalItemsCount">  {{startItemIndex+1}} - {{endItemIndex+1}} displayed<span>, {{totalItemsCount}} in total</span></span></p><button ng-show="pageCanGoForward" ng-click="gridOptions.currentPage=gridOptions.currentPage+1" type="button" class="btn btn-default navbar-btn navbar-left" title="Next Page">&rArr;</button></div>'},replace:true,link:{pre:function(H,I,G,F){E(H,F)},post:function(H,I,G,F){H.$watchCollection("[gridOptions.currentPage, gridOptions.items.length, gridOptions.totalItems, gridOptions.pageItems]",function(K,J){E(H,F)})}}}}])})(TrNgGrid||(TrNgGrid={}));